# 登录认证

## 1.基础理念

登录认证说到低就是查询，**select * from user where username = #{username} and password = #{password}**

如果查到了就说明是正确登录的，否则就是错误的

## 2.登录校验

首先我们要清楚，http协议是<font color="red">无状态</font>的协议，啥是无状态的，请求之间是毫无关联的，这一次的请求不记得上一次的请求。

我们的某些功能，也可以说是某些接口，是不允许用户没有登录访问的，同时如果用户登录了，我们也必须记住这次这个**登录状态**。

这就引出了登录校验我认为最核心的——**<font color="red">会话技术</font>**

### 1.会话技术

会话:顾名思义就是一次对话，从用户打开了网页开始，直到关闭这个网页或者浏览器，之间用户所有的请求都是处于一个会话中

可是我们的浏览器和服务端是怎么知道这是一个请求呢？

有三种方案:

**1.cookie**

**2.session**

**3.令牌技术**

#### 1.cookie

cookie是浏览器自带的客户端会话跟踪技术,这个技术是基于http请求的，所以作为开发人员这个技术挺方便的。

后端请求代码:

```java
@RestController
@AllArgsConstructor
@Slf4j
public class UserController {
    private final IUserService userService;
    @GetMapping("/c1")
    public String setCookie(HttpServletResponse response){
        response.addCookie(new Cookie("username","yiyi"));
        return "ok";
    }
    @GetMapping("/c2")
    public String getCookie(HttpServletRequest request){
        Cookie[] cookies = request.getCookies();
        for (Cookie cookie : cookies) {
            if(cookie.getName().equals("username")){
                log.info("cookie:{}",cookie.getValue());
            }
        }
        return "ok";
    }
}
```

当浏览器访问这个请求的时候，会自动把这个cookie解析出来保存

![](assets/后端增加cookie.png)

 当我们访问其他接口的时候，cookie就会自动携带到请求中

比如在getCookie中就可以获取到请求中的cookie。

**<font color="red">cookie的三个自动:</font>**

<font color="red">1.服务器会自动的将cookie响应给浏览器</font>

<font color="red">2.浏览器接收到响应回来的数据之后，会自动的将cookie存储到浏览器本地</font>

<font color="red">3.在后续的请求当中，浏览器会自动的将cookie携带到服务器端</font>



优缺点:

优点:Http协议中支持的技术(像set-cookie响应头的解析以及Cookie请求头数据的携带，都是浏览器自动进行的)

缺点:

1. 移动端App(Android、iOS)中无法使用Cookie

2. 不安全，用户可以自己禁用Cookie

3. Cookie不能跨域








