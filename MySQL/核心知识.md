# MySQL核心知识

## 1.DQL语句执行顺序

DQL语句格式:

```mysql
select 字段名
from 表名
where 筛选条件
group by 分组字段
having 分组之后的条件(可加聚合函数)
order by 排序字段
limit 分页
```

DQL语句执行顺序

```mysql
1.from
2.where
3.group by
4.having
5.select
6.order by
7.limit
```

where与having的区别：

1.执行时机不同:where在分组之前筛选,having在分组之后筛选

2.判断条件不同:having中可以用聚合条件，而where中不可以

## 2.常用函数

### 2.1字符串函数

| 函数                            | 功能                                      |
| ------------------------------- | ----------------------------------------- |
| concat(str1,str2,str3,...,strn) | 将str1,str2,str3,...,strn连接起来         |
| lower(str)                      | 将str全部转为小写                         |
| upper(str)                      | 将str全部转为大写                         |
| lpad(str,len,s)                 | 将str填充为len个字符，向左填充s           |
| rpad(str,len,s)                 | 将str填充为len个字符，向右填充s           |
| trim(str)                       | 去除str前面和后面的空格                   |
| substring(str,start,len)        | 截取str,start开始的len个字符(下标从1开始) |

###2.2数值函数

| 函数       | 功能                      |
| ---------- | ------------------------- |
| ceil(x)    | 对x向上取整               |
| floor(x)   | 对x向下取整               |
| mod(x,y)   | 返回x%y的值               |
| rand()     | 返回一个[0,1)之间的随机数 |
| round(x,y) | 对x保留y位小数,四舍五入   |

### 2.3日期函数

| 函数                              | 功能                             |
| --------------------------------- | -------------------------------- |
| curdate()                         | 返回当前日期                     |
| curtime()                         | 返回当前时间                     |
| now()                             | 返回当前日期+时间                |
| year(date)                        | 返回指定日期/时间的所在年        |
| month(date)                       | 返回指定日期/时间的所在月        |
| day(date)                         | 返回指定日期/时间的所在日        |
| date_add(date,interval expr type) | 将date加上一个指定type类型的时间 |
| datediff(date1,date2)             | date1-date2的天数                |

### 2.4流程函数

| 函数                                       | 功能                                               |
| ------------------------------------------ | -------------------------------------------------- |
| if(value,t,f)                              | value为true,返回t否则返回f                         |
| ifnull(v1,v2)                              | v1为null,返回v2,否则返回v1                         |
| case var when v1 then r1 else default  end | 当var==v1时，返回r1，如果都没有匹配上，返回default |
| case when v1 then r1 else default end      | 当v1为true时返回r1,如果都为false,返回default       |

## 3.约束

约束作用于数据库中的字段，目的是保证数据库中的数据的正确性

以下为外键约束的分类:

| 约束                          | 描述                                           | 关键字      |
| ----------------------------- | ---------------------------------------------- | ----------- |
| 非空约束                      | 该字段的数据不能为null                         | not null    |
| 唯一约束                      | 该字段的数据不能重复，必须唯一                 | unique      |
| 主键约束                      | 该字段的数据必须:非空+唯一，用于区分一行数据   | primary key |
| 默认约束                      | 如果该字段插入时没有指定值，则显示该值         | default     |
| 检查约束(mysql8.0.16版本之后) | 该字段的数据必须符合检查                       | check       |
| 外键约束                      | 该字段的数据必须在其他表中存在，用来连接两张表 | foreign key |

## 4.外键行为

对一个表添加外键约束:

```mysql
create table 表名(
	字段名 数据类型
    ...
    [constraint] [外键名称] foreign key (外键字段名) references 主表(主表列名)
);
```

```mysql
add table 表名 add constraint 外键名称 foreign key (外键字段名) references 主表(主表列名)
```

删除外键:

```mysql
alter table 表名 drop foreign key 外键名称
```

添加了外键之后，再删除父表数据时产生的约束行为,我们就成为删除/更新行为。具体的删除/更新行为有以下几种:

| 行为        | 说明                                                         |
| ----------- | ------------------------------------------------------------ |
| no action   | 当在父表中删除/更新数据时，如果该数据有对应外键，不允许删除/更新(与restrict一致) |
| restrict    | 当在父表中删除/更新数据时，如果该数据有对应外键，不允许删除/更新(与no action一致) |
| cascade     | 当在父表中删除/更新数据时，如果该数据有对应外键，子表也删除/更新该数据 |
| set null    | 当在父表中删除/更新数据时，如果该数据有对应外键，子表中该外键值为null(字段约束不能为null) |
| set default | 父表有变更时，子表将外键列设置为一个默认的值(Innodb不支持)   |

具体语法为:

```mysql
ALTER TABLE 表名 ADD CONSTRAINT 外键名称 FOREIGN KEY (外键字段) REFERENCES
主表名 (主表字段名) ON UPDATE CASCADE ON DELETE CASCADE;
```

